{{template "header.html" .}}

<title>{{abbrTitle .ParentArticle.Content}}... {{.ParentArticle.ID}}</title>

<style>
#home, #footer {
    display: none;
}
</style>

<nav>
    <a onclick="closeWin()"><i class=icon-left-small></i> 返回</a>
</nav>

{{template "post_box.html" .ReplyView}}

<div>
    <div class="timeline" id="timeline{{.ReplyView.UUID}}" > 
        {{template "row_content.html" .ParentArticle}}

        <div class=article-row style='display:flex;align-items:center'>
            <span style="display:inline-block;flex:1 0 auto;padding-left:0.5em">
                共 {{.ParentArticle.Replies}} 回复
                {{if and .ParentArticle.ReplyLockMode .ShowReplyLockInfo}}
                {{if eq .ParentArticle.ReplyLockMode 1}}/ 禁止回复<style>#post-button{display:none}</style>{{end}}
                    {{if eq .ParentArticle.ReplyLockMode 2}}/ 仅限作者关注的人回复{{end}}
                    {{if eq .ParentArticle.ReplyLockMode 3}}/ 仅限作者关注和被@的人回复{{end}}
                    {{if eq .ParentArticle.ReplyLockMode 4}}/ 仅限作者关注的和其粉丝回复{{end}}
                {{end}}
            </span>
            <div style='float:right' >
                <button class="gbutton" onclick='(function(btn) {
                        var stop = $wait(btn);
                        $post("/api2/new", { parent: "{{.ParentArticle.ID}}" }, function (res, h) {
                        stop();
                        if (res.substring(0, 3) !== "ok:") return res;
                        onPostFinished({ html: decodeURIComponent(res.substr(3)), uuid: "{{.ReplyView.UUID}}", parent: "{{.ParentArticle.ID}}" });
                        }, stop);
                        })(this)'>
                    <i class=icon-link></i> 转发 
                </button>&nbsp;
                <button class="gbutton tmpl-green-text" onclick="postBox('{{.ReplyView.UUID}}','{{.ReplyView.ReplyTo}}', window.name)" id=post-button>
                    <i class=icon-comment></i> 回复
                </button>
            </div>
        </div>

        <div class="row-reply-inserter" style="display:none"></div>

        {{range .Articles}}
        {{template "row_content.html" .}}
        {{end}}
    </div>

    <div class="paging">
        {{if .Next}}
        <button id="load-more" value="{{.Next}}" class="gbutton" onclick="loadMore(this,{reply:true})">更多回复...</button>
        {{end}}
        <script>
            window.name = "win{{.ReplyView.UUID}}"
        </script>
    </div>
</div>
